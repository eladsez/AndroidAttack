/*
 * File: app/view/MainNav.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.0.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('CatApp.view.MainNav', {
    extend: 'Ext.navigation.View',
    alias: 'widget.mainnav',

    config: {
        id: 'mainNav',
        items: [
            {
                xtype: 'container',
                cls: [
                    'whiteBG'
                ],
                id: 'mianPage',
                itemId: 'mycontainer6',
                layout: {
                    type: 'vbox'
                },
                scrollable: 'vertical',
                items: [
                    {
                        xtype: 'button',
                        cls: 'mainButton',
                        html: '<img class=\'mainIcon\' src=\'appImages/siIcon.png\' /><h1 class="mainButtonHeader">Storm Info.<br /><span class="mainButtonSubtext">Relevant storm information</span></h1>',
                        id: 'btnNotices',
                        itemId: ''
                    },
                    {
                        xtype: 'button',
                        cls: 'mainButton',
                        html: '<img class=\'mainIcon\' src=\'appImages/qrIcon.png\' /><h1 class="mainButtonHeader">Quick Reference<br /><span class="mainButtonSubtext">Cat Guide Quick Reference</span></h1>',
                        id: 'btnQuickRef',
                        itemId: 'mybutton4',
                        text: ''
                    },
                    {
                        xtype: 'button',
                        cls: 'mainButton',
                        html: '<img class=\'mainIcon\' src=\'appImages/cnIcon.png\' /><h1 class="mainButtonHeader">Claim Numbers<br /><span class="mainButtonSubtext">Listing of Company Claim Numbers</span></h1>',
                        id: 'btnClaimNumbers',
                        itemId: 'mybutton4'
                    },
                    {
                        xtype: 'button',
                        cls: 'mainButton',
                        html: '<img class=\'mainIcon\' src=\'appImages/emerIcon.png\' /><h1 class="mainButtonHeader">County OEMs<br /><span class="mainButtonSubtext">Offices of Emergency Management</span></h1>',
                        id: 'btnCountyEOC',
                        itemId: 'mybutton11'
                    }
                ]
            },
            {
                xtype: 'toolbar',
                cls: [
                    'whiteBG'
                ],
                docked: 'bottom',
                itemId: 'mytoolbar',
                items: [
                    {
                        xtype: 'button',
                        cls: 'refreshButton',
                        id: 'btnRefreshAppData',
                        itemId: 'btnRefreshAppData',
                        iconCls: 'refresh',
                        iconMask: true
                    }
                ]
            }
        ],
        navigationBar: {
            cls: 'mainNavigationBar',
            itemId: 'mynavigationbar'
        },
        listeners: [
            {
                fn: 'onMainNavShow',
                event: 'show'
            }
        ]
    },

    onMainNavShow: function(component, options) {
        var mainNav = Ext.getCmp('mainNav');
        mainNav.mask({
            xtype: 'loadmask',
            message: 'Refreshing App Data...'
        });


        //get storms
        var store = Ext.data.StoreManager.lookup('stormStore'),
        url = 'http://catnj.faia.net/ResourceWebService.svc/GetStorms';

        store.getProxy().setUrl(url);

        store.load(store);


        //get claim numbers
        var store2 = Ext.data.StoreManager.lookup('CompanyClaimNumberStore'),
        url2 = 'http://catnj.faia.net/ResourceWebService.svc/GetClaimNumbers';

        store2.getProxy().setUrl(url2);

        store2.load(store2);


        //get emergency operation center
        var store3 = Ext.data.StoreManager.lookup('EOCStore'),
        url3 = 'http://catnj.faia.net/ResourceWebService.svc/GetEOCs';

        store3.getProxy().setUrl(url3);

        store3.load(store3);

        //give a 3 second delay to let the user know the app is trying to load data.
        setTimeout(function(){
            mainNav.unmask();
        }, 4000);
    }

});