/*
 * File: app/controller/MainPageController.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.0.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('CatApp.controller.MainPageController', {
    extend: 'Ext.app.Controller',

    config: {
        refs: {
            zoneCoordinatorDetail: '#pnlZCDetails',
            mainNav: 'mainnav',
            claimNumberDetail: '#claimNumberDetail',
            companyDetail: '#companyDetails',
            currentWeatherCtr: '#containerCurrentWeather'
        },

        control: {
            "#btnNotices": {
                tap: 'onBtnNoticesTap'
            },
            "#btnZoneCoordinators": {
                tap: 'onBtnZoneCoordinatorTap'
            },
            "#mainNav #listZoneCoordinator": {
                itemtap: 'onListZCTap'
            },
            "#btnClaimNumbers": {
                tap: 'onBtnClaimNumbersTap'
            },
            "#mainNav #listCompanyClaimNumbers": {
                itemtap: 'onListCompanyClaimNumbersItemTap'
            },
            "#btnQuickRef": {
                tap: 'onBtnQuickRefTap'
            },
            "#mainNav #listCatGuide": {
                itemtap: 'onListCatGuideItemTap'
            },
            "#btnRefreshAppData": {
                tap: 'onBtnRefreshAppDataTap'
            },
            "#btnCountyEOC": {
                tap: 'onBtnCountyEOCTap'
            },
            "#mainNav #listEOC": {
                itemtap: 'onListEOCItemTap'
            }
        }
    },

    onBtnNoticesTap: function(button, e, options) {
        button.up('mainnav').push({ xtype: 'liststorms',title: '' });

        var btnRefreshAppData = Ext.getCmp('btnRefreshAppData');
        btnRefreshAppData.show();
    },

    onBtnZoneCoordinatorTap: function(button, e, options) {
        //var list = Ext.create('CatApp.view.ListZoneCoordinators', { title: 'Zone'});

        button.up('mainnav').push({ xtype: 'ctrzonecoordinatorcard', title: '' });


    },

    onListZCTap: function(dataview, index, target, record, e, options) {
        var me = this, 
        details;


        if(record)
        {
            details = Ext.create('CatApp.view.PanelZoneCoordinatorDetail', { title: ''});

            //set record details
            details.child('#contact').setData(record.data);

            me.getMainNav().push(details);
        }
    },

    onBtnClaimNumbersTap: function(button, e, options) {
        button.up('mainnav').push({ xtype: 'listcompanyclaimnumbers',title: '' });
    },

    onListCompanyClaimNumbersItemTap: function(dataview, index, target, record, e, options) {
        var me = this, 
        details;


        if(record)
        {
            details = Ext.create('CatApp.view.ClaimNumberDetail', { title: ''});

            //set record details
            details.child('#companyDetails').setData(record.data);

            me.getMainNav().push(details);
        }
    },

    onBtnQuickRefTap: function(button, e, options) {
        button.up('mainnav').push({ xtype: 'listcatguide',title: '' });

    },

    onListCatGuideItemTap: function(dataview, index, target, record, e, options) {
        var me = this, 
        details;


        if(record)
        {
            details = Ext.create('CatApp.view.CatGuideDetail', { title: ''});

            //set record details
            details.setData(record.data);

            me.getMainNav().push(details);
        }
    },

    onBtnRefreshAppDataTap: function(button, e, options) {


        var mainNav = Ext.getCmp('mainNav');
        mainNav.mask({
            xtype: 'loadmask',
            message: 'Refreshing App Data...'
        });


        //get storms
        var store = Ext.data.StoreManager.lookup('stormStore'),
        url = 'http://catnj.faia.net/ResourceWebService.svc/GetStorms';

        store.getProxy().setUrl(url);

        store.load(store);


        //get claim numbers
        var store2 = Ext.data.StoreManager.lookup('CompanyClaimNumberStore'),
        url2 = 'http://catnj.faia.net/ResourceWebService.svc/GetClaimNumbers';

        store2.getProxy().setUrl(url2);

        store2.load(store2);


        //get emergency operation center
        var store3 = Ext.data.StoreManager.lookup('EOCStore'),
        url3 = 'http://catnj.faia.net/ResourceWebService.svc/GetEOCs';

        store3.getProxy().setUrl(url3);

        store3.load(store3);

        //give a 3 second delay to let the user know the app is trying to load data.
        setTimeout(function(){
            mainNav.unmask();
        }, 4000);


		//get cat guide topics
		var store4 = Ext.data.StoreManager.lookup('CatGuideTopicStore'),
		url4 = 'http://catnj.faia.net/ResourceWebService.svc/GetCatGuideTopics';
		
		store4.getProxy().setUrl(url4);
		
		store4.load(store4);
		
		//give a 3 second delay to let the user know the app is trying to load data.
		setTimeout(function(){
		    mainNav.unmask();
		}, 4000);

    },

    onBtnCountyEOCTap: function(button, e, options) {
        button.up('mainnav').push({ xtype: 'listeoc', title: '' });
    },

    onListEOCItemTap: function(dataview, index, target, record, e, options) {
        var me = this, 
        details;


        if(record)
        {
            details = Ext.create('CatApp.view.EOCDetail', { title: ''});

            //set record details
            details.child('#details').setData(record.data);

            me.getMainNav().push(details);
        }
    }

});